<html>
	<head>
		<title>Grade calculator</title>
		<link rel = "stylesheet" href = "style.css">
		<!--Boxicons-->
		<link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
		<link href='https://fonts.googleapis.com/css?family=Nova Flat' rel='stylesheet'>

		<script type = "text/javascript">
			function arrange_work_buttons()	{
				//SHOW WORK DONE SO FAR
				document.getElementById("work_so_far").innerHTML = '';
				var completedPts = localStorage.getItem(document.getElementById("categoryContainer").innerText + "_donePts")
				if(completedPts === "")	{
					completedPts = null;
					localStorage.removeItem(document.getElementById("categoryContainer").innerText + "_donePts")
				}
				if(completedPts != null)	{
					let val = document.getElementById("categoryContainer").innerText;
					let max = localStorage.getItem(val + "_maxPts");

					const myVal = completedPts.split(",");
					var cat = document.getElementById("categoryContainer").innerText + " "
					for (var i = 0; i < myVal.length; i++)	{
						var title = document.createElement('button')
						title.classList.add("work_button")

						title.addEventListener('click', function(e)	{
							if(e.target)	{
								var vals_split = e.target.innerText.split(": ");
								val_split = vals_split[0].split(" ");
								var index = val_split[val_split.length - 1] - 1
								var compPts = localStorage.getItem(document.getElementById("categoryContainer").innerText + "_donePts")
								var dummyPts = compPts.split(",")
								var answer = window.confirm("Are you sure you want to delete " + vals_split[0] + "?");
								if(answer)	{
									//temporarily remove that item list
									localStorage.removeItem(document.getElementById("categoryContainer").innerText + "_donePts")
									var new_values = ""
									for(var k = 0; k < dummyPts.length; k++)	{
										if(k !== parseInt(index))	{
											if(new_values === "")	{
												new_values += dummyPts[k]
											}
											else {
												new_values += "," + dummyPts[k]
											}
										}
									}
									localStorage.setItem(document.getElementById("categoryContainer").innerText + "_donePts", new_values);
									console.log(localStorage);
									arrange_work_buttons();
								}
								
							}
						})
						title.innerText = cat + String(i + 1) + ": " + myVal[i] + " / " + max;
						document.getElementById("work_so_far").appendChild(title);
					}
				}
			}


			function reload()	{
				for(var i = 0; i < localStorage.length; i++)	{
					if(localStorage.key(i).includes("category_"))	{
						var paragraph = document.createElement('button')
						paragraph.classList.add("button_format")
						paragraph.innerText = localStorage.getItem(localStorage.key(i));

						//cancellation button
						var cancel = document.createElement('button')
						cancel.classList.add("cancel_button")
						cancel.innerText = localStorage.getItem(localStorage.key(i));
						
						cancel.addEventListener('click', function(e)	{
							if(e.target)	{
								var title = document.createElement('p')
								var answer = window.confirm("Are you sure you want to delete the category " + e.target.innerText + "?");
								if(answer)	{
									//delete the category
									var dummy_storage = {};
									Object.assign(dummy_storage, localStorage);
									localStorage.clear()
									var text = e.target.innerText;
									var text_1 = text + "_weight"
									for (const [key, value] of Object.entries(dummy_storage))	{
										if((value !== text) && (key !== text + "_weight") && (key !== (text + "_num_assess")) && (key !== (text + "_maxPts")) && (key !== (text + "_donePts")))	{
											console.log(value);
											localStorage.setItem(key, value);
										}
									}

									console.log(localStorage)
									document.getElementById("toDoContainer").innerHTML = '';
									document.getElementById("del").innerHTML = '';

									document.getElementById("categoryContainer").innerHTML = 'Select a category';
									document.getElementById("weight_info").innerHTML = "Weight: --"
									document.getElementById("num_info").innerHTML = 'Number of assessments: --'
									document.getElementById("max_points").innerHTML = "Max pts on each assessment: --"
									document.getElementById("work_so_far").innerHTML = ''
									reload();
								}
							}
						})

						del.appendChild(cancel);

						paragraph.addEventListener('click', function(e) {
							if(e.target)	{
								var title = document.createElement('p')
								title.innerText = e.target.innerText;
								document.getElementById("categoryContainer").innerHTML = '';
								document.getElementById("categoryContainer").appendChild(title);

								//SHOW WEIGHT
								var weightage = localStorage.getItem(document.getElementById("categoryContainer").innerText + "_weight")
								var title = document.createElement('p')
								document.getElementById("weight_info").innerHTML = '';
								if(weightage != null)	{
									title.innerText = "Weight: " + weightage
								}
								else {
									title.innerText = "Weight: --"
								}
								document.getElementById("weight_info").appendChild(title);

								//SHOW NUM ASSESSMENTS
								var num_assessments = localStorage.getItem(document.getElementById("categoryContainer").innerText + "_num_assess")
								var title = document.createElement('p')
								document.getElementById("num_info").innerHTML = '';
								if(num_assessments != null)	{
									title.innerText = "Number of assessments: " + num_assessments
								}
								else {
									title.innerText = "Number of assessments: --"
								}
								document.getElementById("num_info").appendChild(title);

								//SHOW MAX PTS
								var max_point_val = localStorage.getItem(document.getElementById("categoryContainer").innerText + "_maxPts")
								var title = document.createElement('p')
								document.getElementById("max_points").innerHTML = '';
								if(max_point_val != null)	{
									title.innerText = "Max pts on each assessment: " + max_point_val
								}
								else {
									title.innerText = "Max pts on each assessment: --"
								}
								document.getElementById("max_points").appendChild(title);

								//show work done so far
								arrange_work_buttons();
							}
						})
						toDoContainer.appendChild(paragraph);
					}
				}
			}

			window.onload = reload;
			function fn1()
			{
				localStorage.clear()
			}
			console.log(localStorage);
		</script>
	</head>
	<body>
			<div class = "category">
				<div class = 'categoryLetters'>
					<div id = "categoryContainer">Select a category</div>
					<div class = "categoryValues"> </div>
					<div class = 'enter'> 
						Category weighting
						<input class = "input_vals" id = "weight" type = "text"><button class = "mini_button" id = "addWeight">+</button>
					</div>
					<div class = 'enter'>
						Number of assessments
						<input class = "input_vals" id = "num_asses" type = "text"><button class = "mini_button" id = "addNum">+</button>
					</div>
					<div class = 'enter'>
						Max pts on each assessment
						<input class = "input_vals" id = "max_pts" type = "text"><button class = "mini_button" id = "addPts">+</button> 
					</div>
					<div class = 'assesments_so_far'>
						Enter pts of work completed so far:
						<input class = "input_vals" id = "asses_done" type = "text"><button class = "mini_button" id = "addDonePts">+</button>
					</div>
				</div>
				<div class = "info">
					<div id = "weight_info"> Weight: -- </div>
					<div id = "num_info"> Number of assessments: -- </div>
					<div id = "max_points"> Max pts on each assessment: -- </div> 
				</div>
				<div class = "logo_pts">
					WORK COMPLETED SO FAR
					<div id = "work_so_far"></div>
				</div>
			</div>
			<!--sidebar-->
			<div class = "sidebar">
				<div class = "logo_content">
					<div class = "logo">
						<i class='bx bx-book-content'></i>
						<div class = "logo_name">CATEGORIES</div>
					</div>
				</div>
				<div class = "container">
					<input id = "inputField" type = "text"><button id = "addToDo">+</button>
					<div class = "to-dos" id = "toDoContainer">
						<!-- <button onclick = "fn1()" id = "btn1">clear storage</button> -->
					</div>
					<div class = "cancellation" id = "del"></div>
				</div>
			</div>


		<script src = "main.js"></script>
	</body>
</html>